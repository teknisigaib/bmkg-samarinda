// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL") // Ini akan baca Port 6543
  directUrl = env("DIRECT_URL")   // Ini akan baca Port 5432
}

// ------------------------------------
// Tabel 1: Berita & Kegiatan
// ------------------------------------
model Post {
  id          String   @id @default(cuid()) // ID unik otomatis (cth: clh123...)
  title       String
  slug        String   @unique // URL harus unik
  category    String   // 'Berita', 'Kegiatan', 'Edukasi'
  content     String   @db.Text // Isi HTML panjang
  excerpt     String   // Ringkasan
  imageUrl    String?  // Link gambar (Opsional/Boleh kosong ditandai ?)
  author      String   @default("Admin")
  isFeatured  Boolean  @default(false)
  createdAt   DateTime @default(now()) // Tanggal otomatis saat dibuat
  updatedAt   DateTime @updatedAt      // Tanggal otomatis saat diedit

  @@map("posts") // Nama tabel di database nanti jadi 'posts' (huruf kecil)
}

// ------------------------------------
// Tabel 2: Publikasi (Buletin, Artikel, Makalah)
// ------------------------------------
model Publication {
  id        String   @id @default(cuid())
  type      String   // 'Buletin', 'Artikel', 'Makalah'
  title     String
  slug      String?  @unique // Opsional, Buletin mungkin tidak butuh slug halaman detail
  author    String   @default("Tim BMKG")
  year      String   // '2024', '2023'
  edition   String?  // Khusus Buletin ('November')
  abstract  String?  @db.Text // Ringkasan (Makalah/Artikel)
  tags      String[] // Array: ["Iklim", "Radar"] (Fitur keren Postgres)
  coverUrl  String?  // Link Cover Gambar
  pdfUrl    String   // Link File PDF (Wajib)
  createdAt DateTime @default(now())

  @@map("publications")
}

// ------------------------------------
// Tabel 3: Iklim
// ------------------------------------
model ClimateData {
  id        String   @id @default(cuid())
  type      String   // 'HTH', 'HujanDasarian', 'HujanBulanan', 'PotensiBanjir'
  title     String   // Judul
  period    String   // Detail Tanggal: "21 - 30 November 2024"
  dasarian  String   // "Dasarian III"
  bulan     String   // "November 2024"
  content   String   @db.Text // Analisis
  imageUrl  String   // Peta
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("climate_data")
}


// ------------------------------------
// Tabel 4: Data Pegawai (BARU)
// ------------------------------------
model Employee {
  id        String   @id @default(cuid())
  name      String
  position  String   // Jabatan
  group     String   // 'Pimpinan', 'Struktural', 'Fungsional'
  image     String?  // URL Foto profil
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("employees") // Nama tabel di Supabase nanti 'employees'
}


// ------------------------------------
// Tabel 5: Dokumen Kinerja (Transparansi)
// ------------------------------------
model PerformanceDoc {
  id        String   @id @default(cuid())
  title     String   // Nama Dokumen (e.g. "Laporan Kinerja 2024")
  category  String   // 'Renstra', 'RencanaKinerja', 'PerjanjianKinerja', 'LaporanKinerja'
  year      String   // '2024'
  fileUrl   String   // Link PDF dari Supabase
  fileSize  String?  // Opsional: "2.5 MB" (Jika bisa didapat dari file object)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("performance_docs")
}


// ------------------------------------
// Tabel 7: Flyer
// ------------------------------------
model Flyer {
  id        String   @id @default(cuid())
  title     String
  image     String   // URL gambar dari Supabase Storage
  link      String?  // Link tujuan saat diklik (opsional)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("flyers")
}

// ------------------------------------
// Tabel 8: PDIE - Data Wilayah & Status
// ------------------------------------
model PdieRegion {
  id           String   @id @default(cuid())
  name         String   @unique // Nama kota harus unik
  rainLevel    String   @default("AMAN") @map("rain_level")     // 'AMAN', 'WASPADA', 'SIAGA', 'AWAS'
  droughtLevel String   @default("AMAN") @map("drought_level")  // 'AMAN', 'WASPADA', 'SIAGA', 'AWAS'
  updatedAt    DateTime @updatedAt @map("updated_at")

  @@map("pdie_regions")
}

// ------------------------------------
// Tabel 9: PDIE - Metadata (Label Periode)
// ------------------------------------
model PdieMeta {
  key   String @id // Primary key, misal: "periode_label"
  value String     // Isi label, misal: "Dasarian I Januari 2026"

  @@map("pdie_meta")
}

// ------------------------------------
// Tabel 10: PDIE - Dokumen Laporan
// ------------------------------------
model PdieDocument {
  id        String   @id @default(cuid())
  title     String
  fileUrl   String   @map("file_url")   // URL Public untuk download
  filePath  String   @map("file_path")  // Path di Supabase Storage (untuk hapus)
  fileSize  String?  @map("file_size")  // Info ukuran file (e.g. "1.2 MB")
  type      String   // 'HUJAN' atau 'KEKERINGAN'
  date      String   // Disimpan string agar format fleksibel sesuai input admin
  createdAt DateTime @default(now()) @map("created_at")

  @@map("pdie_documents")
}